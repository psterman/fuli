<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>大佬请批阅</title>
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
    <style>
        :root {
            --bg-color: #f5f7fa;
            --card-bg: #f5f7fa;
            --text-color: #666;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --counter-bg: rgba(255, 255, 255, 0.9);
        }

        [data-theme="dark"] {
            --bg-color: #1a1a1a;
            --card-bg: #1a1a1a;
            --text-color: #e0e0e0;
            --shadow-color: rgba(0, 0, 0, 0.3);
            --counter-bg: rgba(45, 45, 45, 0.9);
        }

        body {
            background-color: var(--bg-color);
            transition: background-color 0.3s ease;
        }

        /* 添加龙纹背景 */
        body::before {
            content: '龍';
            position: fixed;
            font-size: 400px;
            opacity: 0.03;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: "华文行楷", "楷体", serif;
            color: var(--text-color);
            pointer-events: none;
            z-index: -1;
        }

        /* 修改 swipe-hint 相关样式 */
        .swipe-hint {
            position: fixed !important;
            bottom: 20px !important;
            left: 0 !important;
            right: 0 !important;
            z-index: 1000;
            opacity: 1;
            display: flex;
            justify-content: space-between;
            pointer-events: none;
            background: none !important;
            padding: 0 20px;
        }

        .swipe-hint span {
            min-width: 120px;
            background-color: var(--counter-bg);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            padding: 15px 25px;
            font-size: 16px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 10px var(--shadow-color);
            pointer-events: auto;
            z-index: 1001;
            position: relative;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: pointer;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            transition: all 0.3s ease;
            border: 1px solid var(--text-color);
        }

        /* 修改图片容器样式 */
        .image-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            width: 100%;
            height: calc(100vh - 100px);
            overflow: hidden;
        }

        .image-card {
            background-color: transparent;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            animation: fadeIn 0.3s ease-out;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            padding: 10px;
            box-sizing: border-box;
            height: 100%;
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
            transition: transform 0.2s ease-out;
            will-change: transform;
        }

        .image-card img {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            object-fit: contain;
            display: block;
            margin: 0 auto;
        }

        /* PC端样式 */
        @media (min-width: 769px) {
            .image-card {
                background-color: transparent;
                border-radius: 12px;
                box-shadow: none;
            }

            .image-card.scrollable {
                overflow-y: auto;
                align-items: flex-start;
            }

            .image-card.scrollable img {
                width: 100%;
                height: auto;
                max-height: none;
            }

            /* PC端滚动条样式 */
            .image-card::-webkit-scrollbar {
                width: 6px;
                background-color: transparent;
            }

            .image-card::-webkit-scrollbar-track {
                background: transparent;
                margin: 10px 0;
            }

            .image-card::-webkit-scrollbar-thumb {
                background-color: var(--text-color);
                opacity: 0.3;
                border-radius: 3px;
                transition: opacity 0.3s;
            }

            .image-card:hover::-webkit-scrollbar-thumb {
                opacity: 0.5;
            }
        }

        /* 修改移动端样式 */
        @media (max-width: 768px) {
            .image-container {
                height: calc(100vh - 80px);
                padding: 0;
                overflow: hidden;
            }

            .image-card {
                background-color: transparent;
                padding: 10px;
                max-width: 100%;
                height: 100%;
                position: relative;
                overflow: hidden;
                box-sizing: border-box;
            }

            /* 长图滚动样式 */
            .image-card.scrollable {
                background-color: transparent;
                display: block !important;
                overflow-y: auto !important;
                overflow-x: hidden !important;
                -webkit-overflow-scrolling: touch;
                scroll-behavior: smooth;
                height: 100%;
                padding: 10px;
                padding-bottom: 60px;
                touch-action: pan-y;
                position: relative;
            }

            .image-card.scrollable img {
                width: 100%;
                height: auto;
                max-width: 100%;
                margin: 0 auto;
                display: block;
            }

            /* 确保滚动容器正确工作 */
            .image-container {
                height: calc(100vh - 80px);
                overflow: hidden;
                padding: 0;
                margin: 0;
                width: 100%;
            }

            /* 优化触摸滚动 */
            .image-card.scrollable {
                overscroll-behavior-y: contain;
                -webkit-overflow-scrolling: touch;
            }

            /* 滚动条样式 */
            .image-card.scrollable::-webkit-scrollbar {
                width: 4px;
                background-color: transparent;
            }

            .image-card.scrollable::-webkit-scrollbar-thumb {
                background-color: var(--text-color);
                border-radius: 4px;
                opacity: 0.5;
            }

            /* 修改滚动进度指示器样式 */
            .scroll-progress {
                position: fixed;
                right: 4px;
                top: 50%;
                transform: translateY(-50%);
                width: 3px;
                height: 100px;
                background-color: rgba(var(--text-color-rgb), 0.1);
                border-radius: 2px;
                pointer-events: none;
                overflow: hidden;
            }

            .scroll-progress-bar {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 0%;
                background-color: var(--text-color);
                border-radius: 2px;
                transition: height 0.1s ease;
            }

            /* 滚动提示样式 */
            .scroll-hint {
                position: fixed;
                top: 50%;
                right: 10px;
                transform: translateY(-50%);
                background-color: var(--counter-bg);
                color: var(--text-color);
                padding: 8px;
                border-radius: 20px;
                font-size: 20px;
                opacity: 0.8;
                z-index: 1000;
                pointer-events: none;
                animation: fadeInOut 3s ease-in-out forwards;
                box-shadow: 0 2px 6px var(--shadow-color);
                backdrop-filter: blur(5px);
                -webkit-backdrop-filter: blur(5px);
            }

            @keyframes fadeInOut {
                0% {
                    opacity: 0;
                    transform: translate(20px, -50%);
                }

                20% {
                    opacity: 0.8;
                    transform: translateY(-50%);
                }

                80% {
                    opacity: 0.8;
                    transform: translateY(-50%);
                }

                100% {
                    opacity: 0;
                    transform: translate(20px, -50%);
                }
            }

            /* 添加滚动进度指示器 */
            .scroll-progress {
                position: fixed;
                right: 4px;
                top: 50%;
                transform: translateY(-50%);
                width: 3px;
                height: 100px;
                background-color: var(--text-color);
                opacity: 0.2;
                border-radius: 2px;
                pointer-events: none;
            }

            .scroll-progress::after {
                content: '';
                position: absolute;
                width: 100%;
                background-color: var(--text-color);
                border-radius: 2px;
                opacity: 0.8;
                transition: all 0.3s ease;
            }
        }

        /* 添加滚动提示动画 */
        @keyframes scrollHint {
            0% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(10px);
            }

            100% {
                transform: translateY(0);
            }
        }

        .scroll-indicator {
            position: fixed;
            right: calc(50% - min(400px, 50%) - 20px);
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 40px;
            border: 2px solid var(--text-color);
            border-radius: 10px;
            opacity: 0.5;
            pointer-events: none;
            animation: scrollHint 2s infinite;
            display: none;
        }

        .scroll-indicator::after {
            content: '';
            position: absolute;
            top: 6px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 8px;
            background-color: var(--text-color);
            border-radius: 2px;
        }

        /* 只在PC端显示滚动提示 */
        @media (min-width: 769px) {
            .scroll-indicator {
                display: block;
            }
        }

        /* 修改放大模式样式 */
        .image-card.zoom-mode {
            overflow: hidden !important;
            height: 100% !important;
        }

        .image-card img.zoomed {
            max-width: none !important;
            width: auto !important;
        }

        #folder-input {
            display: none;
        }

        .folder-button {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            background-color: var(--counter-bg);
            border: none;
            border-radius: 20px;
            color: var(--text-color);
            cursor: pointer;
            z-index: 1000;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-color);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .loading-text {
            color: var(--text-color);
            font-size: 18px;
            margin-top: 20px;
            text-align: center;
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: min(15px, 3vw) min(20px, 4vw);
            border-radius: 20px;
            cursor: pointer;
            box-shadow: 0 2px 10px var(--shadow-color);
            z-index: 1000;
            font-size: min(16px, 4vw);
            border: none;
            color: var(--text-color);
            background-color: var(--counter-bg);
            transition: all 0.3s ease;
            min-width: min(120px, 25vw);
            border: 1px solid var(--text-color);
            background: linear-gradient(to bottom, var(--counter-bg), var(--card-bg));
            content: attr(data-text);
        }

        .exit-button {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: min(15px, 3vw) min(20px, 4vw);
            border-radius: 20px;
            cursor: pointer;
            box-shadow: 0 2px 10px var(--shadow-color);
            z-index: 1000;
            font-size: min(16px, 4vw);
            border: none;
            color: var(--text-color);
            background-color: var(--counter-bg);
            transition: all 0.3s ease;
            min-width: min(120px, 25vw);
            border: 1px solid var(--text-color);
            background: linear-gradient(to bottom, var(--counter-bg), var(--card-bg));
        }

        .exit-button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px var(--shadow-color);
        }

        .stats-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 20px var(--shadow-color);
            text-align: center;
            color: var(--text-color);
            z-index: 2000;
            border: 2px solid var(--text-color);
            background: linear-gradient(to bottom, var(--card-bg), var(--counter-bg));
        }

        .stats-dialog h2 {
            margin-top: 0;
            color: var(--text-color);
        }

        .stats-dialog button {
            margin-top: 20px;
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            background-color: var(--counter-bg);
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .stats-dialog button:hover {
            transform: scale(1.05);
        }

        .next-button {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            border-radius: 20px;
            background-color: var(--counter-bg);
            color: var(--text-color);
            border: none;
            cursor: pointer;
            box-shadow: 0 2px 10px var(--shadow-color);
            transition: all 0.3s ease;
            display: none;
            /* 默认隐藏 */
            z-index: 1000;
        }

        .next-button:hover {
            transform: translateX(-50%) scale(1.05);
        }

        .error-message {
            color: var(--text-color);
            text-align: center;
            margin: 20px;
            font-size: 16px;
        }

        /* 修改统计弹窗样式 */
        .stats-dialog::before {
            content: '📜';
            font-size: 24px;
            display: block;
            margin-bottom: 10px;
        }

        /* 添加图片切换动画样式 */
        @keyframes slideOutLeft {
            to {
                transform: translateX(-100%) rotate(-5deg);
                opacity: 0;
            }
        }

        @keyframes slideOutRight {
            to {
                transform: translateX(100%) rotate(5deg);
                opacity: 0;
            }
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* 添加淡入效果 */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        /* 添加浮动提示样式 */
        .floating-hint {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--counter-bg);
            color: var(--text-color);
            padding: 15px 25px;
            border-radius: 20px;
            box-shadow: 0 2px 10px var(--shadow-color);
            border: 1px solid var(--text-color);
            text-align: center;
            z-index: 10000;
            animation: fadeInOut 3s ease-in-out forwards;
            pointer-events: none;
        }

        @keyframes fadeInOut {
            0% {
                opacity: 0;
            }

            20% {
                opacity: 1;
            }

            80% {
                opacity: 1;
            }

            100% {
                opacity: 0;
            }
        }

        /* 桌面端样式 */
        @media (min-width: 769px) {
            .image-container {
                height: calc(100vh - 100px);
                /* 留出顶部和底部空间 */
                max-width: 800px;
                /* 限制最大宽度 */
                margin: 50px auto;
            }

            .image-card {
                background-color: transparent;
                border-radius: 12px;
                box-shadow: none;
                padding: 20px;
                height: 100%;
                width: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .image-card img {
                width: 100%;
                height: 100%;
                object-fit: contain;
                max-height: calc(100vh - 140px);
                /* 确保图片不会太高 */
            }

            .swipe-hint {
                bottom: -40px;
                /* 调整提示位置 */
            }
        }

        /* 优化触摸设备的滚动体验 */
        @media (pointer: coarse) {
            .image-card.scrollable {
                touch-action: pan-y pinch-zoom;
                -webkit-overflow-scrolling: touch;
                scroll-behavior: smooth;
            }
        }

        /* 优化触控板滚动体验 */
        @media (pointer: fine) {
            .image-card.scrollable {
                scroll-behavior: smooth;
                overscroll-behavior-y: contain;
            }
        }

        /* 通用滚动样式 */
        .image-card.scrollable {
            overflow-y: auto;
            overflow-x: hidden;
            padding-bottom: 60px;
            height: 100%;
        }

        .image-card.scrollable img {
            width: 100%;
            height: auto;
            max-height: none;
            object-fit: contain;
            margin: 0 auto;
            display: block;
        }

        /* 优化触摸设备滚动样式 */
        .image-card.scrollable {
            touch-action: pan-y;
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
            overflow-y: auto !important;
            overflow-x: hidden !important;
            overscroll-behavior-y: contain;
            height: 100%;
            padding: 10px;
            padding-bottom: 60px;
            position: relative;
        }

        .image-card.scrollable img {
            width: 100%;
            height: auto;
            max-width: 100%;
            margin: 0 auto;
            display: block;
            object-fit: contain;
        }

        /* 确保滚动条始终可见 */
        .image-card.scrollable::-webkit-scrollbar {
            width: 6px;
            background-color: transparent;
        }

        .image-card.scrollable::-webkit-scrollbar-thumb {
            background-color: var(--text-color);
            border-radius: 4px;
            opacity: 0.5;
        }
    </style>
</head>

<body>
    <button class="theme-toggle">大佬请护目 🌞</button>
    <button class="exit-button">退朝</button>
    <div id="image-container"></div>

    <script>
        // 在 script 开始处添加
        let imageIndex = null;
        let currentIndex = 0;
        let funnyCount = 0;
        let totalCount = 0;

        // 加载图片索引
        async function loadImageIndex() {
            try {
                const response = await fetch('image_index.json');
                imageIndex = await response.json();
                return true;
            } catch (error) {
                console.error('加载索引文件失败:', error);
                return false;
            }
        }

        // 获取随机图片
        async function getRandomImage() {
            if (!imageIndex && !(await loadImageIndex())) {
                return null;
            }

            const folders = Object.keys(imageIndex.folders);
            const folder = folders[Math.floor(Math.random() * folders.length)];
            const images = imageIndex.folders[folder];
            const image = images[Math.floor(Math.random() * images.length)];
            return `${folder}/${image}`;
        }

        const imageContainer = document.getElementById('image-container');
        let preloadedImages = new Map();
        const MAX_CACHED_IMAGES = 50;  // 增加缓存数量
        let isLoading = false;  // 添加加载状态标记
        let lastTapTime = 0;
        let tapCount = 0;
        let longPressTimer;

        // 加载时的舔狗文案
        const loadingTexts = [
            "奴才正在为皇上准备奏折...",
            "小的正在整理御览资料...",
            "奴才斗胆为陛下筛选...",
            "恳请圣上稍候片刻...",
            "奴才正在诚惶诚恐地准备...",
            "容奴才为陛下精选...",
            "奴才正在战战兢兢地整理...",
            "请容奴才为圣上过目...",
            "奴才正在为万岁爷准备...",
            "小的不敢怠慢，马上呈上...",
            "奴才正在用心准备...",
            "恳请陛下稍作休息...",
            "奴才正在为圣上效劳...",
            "容奴才为陛下筛选精品...",
            "小的正在竭尽全力准备...",
            "奴才正在为皇上精心挑选...",
            "请容奴才再做细选...",
            "万岁爷请稍候，马上呈上...",
            "奴才正在为陛下忙碌...",
            "小的不敢懈怠，即刻呈递...",
            "恳请圣上稍作歇息...",
            "奴才正在为陛下效命...",
            "容小的为皇上准备...",
            "奴才正在为万岁爷甄选...",
            "请容奴才为圣上整理...",
            "小的正在为陛下忙活...",
            "奴才正在为皇上筛选...",
            "恳请万岁爷稍等片刻...",
            "奴才正在为圣上准备...",
            "容小的为陛下效劳...",
            "奴才正在为皇上整理...",
            "请容奴才为万岁爷准备...",
            "小的正在为圣上筛选...",
            "奴才正在为陛下甄选...",
            "恳请皇上稍作休息...",
            "奴才正在为圣上忙碌...",
            "容小的为万岁爷效劳...",
            "奴才正在为陛下准备...",
            "请容奴才为皇上整理...",
            "小的正在为圣上效命...",
            "奴才正在为万岁爷筛选...",
            "恳请陛下稍候片刻...",
            "奴才正在为皇上甄选...",
            "容小的为圣上效劳...",
            "奴才正在为陛下整理...",
            "请容奴才为万岁爷准备...",
            "小的正在为圣上筛选...",
            "奴才正在为皇上效命...",
            "恳请万岁爷稍等片刻...",
            "奴才正在为陛下忙活..."
        ];

        // 左滑文案
        const dislikeTexts = [
            "朕已阅",
            "退下吧",
            "不准奏",
            "无趣",
            "枯燥",
            "乏味",
            "朕不悦",
            "荒谬",
            "胡闹",
            "放肆",
            "大胆",
            "荒唐",
            "糊涂",
            "不知所谓",
            "岂有此理",
            "朕累了",
            "朕乏了",
            "朕倦了",
            "下一个",
            "不值一看",
            "休得胡言",
            "简直可笑",
            "无稽之谈",
            "朕不想看",
            "太过无聊",
            "难登大雅",
            "不知天高地厚",
            "不知分寸",
            "太过草率",
            "朕看不下去了",
            "有辱斯文",
            "贻笑大方",
            "不知检点",
            "不堪入目",
            "朕甚失望",
            "不知悔改",
            "不知进退",
            "不知轻重",
            "不知好歹",
            "不知羞耻",
            "朕心烦了",
            "朕不准",
            "朕不许",
            "朕不要",
            "着实无趣",
            "甚是无味",
            "令朕生厌",
            "令朕不快",
            "令朕反感",
            "令朕作呕"
        ];

        // 右滑文案
        const likeTexts = [
            "龙颜大悦",
            "准奏",
            "甚好",
            "不错",
            "有趣",
            "妙哉",
            "爱卿说得好",
            "朕很欣慰",
            "可",
            "准",
            "御笔亲批",
            "朕准了",
            "甚妙",
            "妙不可言",
            "深得朕心",
            "朕很满意",
            "善",
            "极好",
            "朕笑了",
            "卿家有才",
            "果然精彩",
            "深得朕意",
            "朕甚欢喜",
            "妙笔生花",
            "才思敏捷",
            "朕要重赏",
            "卿家妙极",
            "真乃大才",
            "朕要多看几遍",
            "传朕旨意",
            "朕龙心大悦",
            "妙不可言",
            "绝妙好辞",
            "朕准了",
            "甚合朕意",
            "爱卿用心了",
            "朕很喜欢",
            "可圈可点",
            "令朕开怀",
            "妙趣横生",
            "朕要赏赐",
            "朕要嘉奖",
            "朕要褒奖",
            "朕要表彰",
            "朕要夸赞",
            "朕心甚悦",
            "朕意甚慰",
            "朕心大快",
            "朕意大畅",
            "朕心舒畅",
            "朕准了 👍",
            "甚好 👍",
            "妙哉 👍",
            "有趣 👍",
            "不错 👍",
            "朕喜欢 👍",
            "可 👍",
            "准奏 👍",
            "朕觉得行",
            "有意思 👍",
            "爱卿用心了 👍",
            "朕很满意 👍",
            "这个可以 👍",
            "朕笑了 👍",
            "爱卿懂朕 👍",
            "深得朕心 👍",
            "这个有趣",
            "朕要赏你 👍",
            "甚合朕意 👍",
            "爱卿费心了 👍",
            "这个朕喜欢 👍",
            "朕龙心大悦 👍",
            "这个有水平 👍",
            "爱卿很用心",
            "这个朕准了",
            "朕要重赏 👍",
            "这个有意思 👍",
            "朕觉得不错 👍",
            "爱卿很懂事 👍",
            "这个值得赏 👍"
        ];

        // 使用 GitHub API 获取仓库中 pic 文件夹的内容
        const owner = 'psterman';
        const repo = 'dlqpy';
        const path = 'pic';

        // CDN 配置
        const CDN_CONFIGS = {
            // 中国大陆优先使用这些 CDN
            CN: [
                'https://gcore.jsdelivr.net/gh',  // Gcore CDN
                'https://fastly.jsdelivr.net/gh', // Fastly CDN
                'https://cdn.jsdelivr.net/gh'     // jsDelivr Main
            ],
            // 其他地区优先使用这些 CDN
            GLOBAL: [
                'https://cdn.jsdelivr.net/gh',
                'https://fastly.jsdelivr.net/gh',
                'https://gcore.jsdelivr.net/gh'
            ]
        };

        // 检测用户位置并选择最佳 CDN
        async function detectBestCDN() {
            try {
                // 使用 ipapi.co 检测用户位置
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                const isChina = data.country === 'CN';

                // 测试每个 CDN 的响应时间
                const cdnList = isChina ? CDN_CONFIGS.CN : CDN_CONFIGS.GLOBAL;
                const testImage = `${owner}/${repo}@main/${path}/test.jpg`;

                const cdnPromises = cdnList.map(async (cdn) => {
                    const startTime = performance.now();
                    try {
                        const img = new Image();
                        await new Promise((resolve, reject) => {
                            img.onload = resolve;
                            img.onerror = reject;
                            img.src = `${cdn}/${testImage}?t=${Date.now()}`;
                        });
                        return {
                            cdn,
                            time: performance.now() - startTime
                        };
                    } catch {
                        return {
                            cdn,
                            time: Infinity
                        };
                    }
                });

                const results = await Promise.all(cdnPromises);
                results.sort((a, b) => a.time - b.time);
                return results.map(r => r.cdn);
            } catch (error) {
                console.log('CDN detection failed, using default order:', error);
                return CDN_CONFIGS.GLOBAL;
            }
        }

        function getOptimizedImageUrl(url, isMobile) {
            // 直接使用原始 URL，让浏览器自己处理缩放
            return url;
        }

        async function loadImages() {
            if (!imageIndex && !(await loadImageIndex())) {
                console.error('无法加载图片索引');
                return;
            }

            // 从所有文件夹获取图片
            const allImages = [];
            const folders = Object.keys(imageIndex.folders);
            folders.forEach(folder => {
                const images = imageIndex.folders[folder];
                images.forEach(image => {
                    allImages.push({
                        url: `${folder}/${image}`,
                        folder: folder
                    });
                });
            });

            // 随机打乱图片顺序
            images = _.shuffle(allImages);

            // 显示第一张图片
            if (images.length > 0) {
                showImage(0);
            }
        }

        function showImage(index) {
            if (index < 0 || index >= images.length) return;

            currentIndex = index;
            const image = images[currentIndex];

            const container = document.getElementById('image-container');
            container.innerHTML = `
                <div class="image-card">
                    <img src="${image.url}" alt="Image ${currentIndex + 1}">
                </div>
            `;

            // 更新其他UI元素
            updateSwipeHint();
            // ... 其他UI更新代码 ...
        }

        // 添加计数器更新函数
        function updateCounter() {
            const funnyRate = (funnyCount / totalCount * 100) || 0;
            const evaluation = getEvaluationText(funnyRate);
            // 可以在这里添加显示评价的逻辑
        }

        function getRandomText(isLike) {
            const texts = isLike ? likeTexts : dislikeTexts;
            return texts[Math.floor(Math.random() * texts.length)];
        }

        // 添加左右滑动处理
        let startX = 0;
        let currentX = 0;
        let startTime = 0;  // 记录开始滑动的时间
        let isMoving = false;  // 标记是否在滑动中
        let isMouseDown = false;

        // 添加键盘事件监听
        document.addEventListener('keydown', handleKeyPress);

        function handleKeyPress(e) {
            const card = document.querySelector('.image-card');
            if (!card) return;

            switch (e.key) {
                case 'ArrowLeft':
                    // 左箭头：不喜欢
                    // 先更新按钮状态
                    updateButtonsOnSwipe(-window.innerWidth * 0.2);

                    // 添加动画效果
                    card.style.transition = 'transform 0.2s ease-out';
                    card.style.transform = 'translateX(-100%)';

                    setTimeout(() => {
                        currentIndex++;
                        showImage(currentIndex);
                        checkAndResetImages();
                        // 重新加载按钮文案
                        updateSwipeHint();
                    }, 200);
                    break;

                case 'ArrowRight':
                    // 右箭头：喜欢
                    // 先更新按钮状态
                    updateButtonsOnSwipe(window.innerWidth * 0.2);

                    // 添加动画效果
                    card.style.transition = 'transform 0.2s ease-out';
                    card.style.transform = 'translateX(100%)';

                    setTimeout(() => {
                        currentIndex++;
                        funnyCount++;
                        showImage(currentIndex);
                        checkAndResetImages();
                        // 重新加载按钮文案
                        updateSwipeHint();
                    }, 200);
                    break;
            }
        }

        // 检查是否需要重置图片列表
        function checkAndResetImages() {
            if (currentIndex >= images.length) {
                const currentImage = images[currentIndex - 1];  // 保存当前图片
                images = _.shuffle(images);
                // 确保新的第一张不是上一轮的最后一张
                while (images[0].url === currentImage.url && images.length > 1) {
                    images = _.shuffle(images);
                }
                currentIndex = 0;
                showImage(currentIndex);
            }
        }

        imageContainer.addEventListener('touchstart', handleStart);
        imageContainer.addEventListener('touchmove', handleMove);
        imageContainer.addEventListener('touchend', handleEnd);

        // 添加鼠标事件监听
        imageContainer.addEventListener('mousedown', handleMouseStart);
        imageContainer.addEventListener('mousemove', handleMouseMove);
        imageContainer.addEventListener('mouseup', handleMouseEnd);
        imageContainer.addEventListener('mouseleave', handleMouseEnd);

        function handleStart(e) {
            const currentTime = Date.now();
            startX = e.touches[0].clientX;
            currentX = startX;
            startTime = Date.now();
            isMoving = true;
        }

        function handleMouseStart(e) {
            isMouseDown = true;
            isMoving = true;
            startX = e.clientX;
            currentX = startX;
            startTime = Date.now();

            // 添加拖动时的鼠标样式
            const card = document.querySelector('.image-card');
            card.style.cursor = 'grabbing';
        }

        function handleMove(e) {
            if (!isMoving) return;
            e.preventDefault();
            currentX = e.touches[0].clientX;
            const diff = currentX - startX;

            // 更新按钮状态
            updateButtonsOnSwipe(diff);

            const card = document.querySelector('.image-card');
            if (card) {
                requestAnimationFrame(() => {
                    card.style.transform = `translateX(${diff}px)`;
                });
            }
        }

        function handleMouseMove(e) {
            if (!isMouseDown) return;
            e.preventDefault();
            e.stopPropagation();

            currentX = e.clientX;
            const diff = currentX - startX;

            // 更新按钮状态
            updateButtonsOnSwipe(diff);

            const card = document.querySelector('.image-card');
            if (card) {
                requestAnimationFrame(() => {
                    card.style.transform = `translateX(${diff}px)`;
                });
            }
        }

        function handleEnd(e) {
            if (!isMoving) return;
            isMoving = false;

            const diff = currentX - startX;
            const threshold = window.innerWidth * 0.2;
            const timeElapsed = Date.now() - startTime;
            const velocity = Math.abs(diff) / Math.max(timeElapsed, 1);

            if (Math.abs(diff) > threshold * 0.3 || (Math.abs(diff) > 20 && velocity > 0.2)) {
                if (diff > 0) {  // 右滑表示喜欢
                    currentIndex++;
                    funnyCount++;
                } else {  // 左滑表示不喜欢
                    currentIndex++;
                }

                // 添加动画效果
                const card = document.querySelector('.image-card');
                if (card) {
                    card.style.transition = 'transform 0.2s ease-out';
                    card.style.transform = `translateX(${diff > 0 ? '100%' : '-100%'})`;
                    setTimeout(() => {
                        showImage(currentIndex);
                        checkAndResetImages();
                        // 重新加载按钮文案
                        updateSwipeHint();
                    }, 200);
                }
            } else {
                // 恢复原位的动画
                const card = document.querySelector('.image-card');
                if (card) {
                    card.style.transition = 'transform 0.2s ease-out';
                    card.style.transform = 'translateX(0)';
                    setTimeout(() => {
                        card.style.transition = '';
                    }, 200);
                }
                // 恢复按钮状态
                updateButtonsOnSwipe(0);
            }
        }

        function handleMouseEnd(e) {
            if (!isMouseDown) return;
            isMouseDown = false;
            isMoving = false;

            const diff = e.clientX - startX;
            const threshold = window.innerWidth * 0.2;
            const timeElapsed = Date.now() - startTime;
            const velocity = Math.abs(diff) / Math.max(timeElapsed, 1);

            if (Math.abs(diff) > threshold * 0.3 || (Math.abs(diff) > 20 && velocity > 0.2)) {
                if (diff > 0) {  // 右滑表示喜欢
                    currentIndex++;
                    funnyCount++;
                } else {  // 左滑表示不喜欢
                    currentIndex++;
                }

                const card = document.querySelector('.image-card');
                if (card) {
                    card.style.transition = 'transform 0.2s ease-out';
                    card.style.transform = `translateX(${diff > 0 ? '100%' : '-100%'})`;
                    setTimeout(() => {
                        showImage(currentIndex);
                        checkAndResetImages();
                        // 重新加载按钮文案
                        updateSwipeHint();
                    }, 200);
                }
            } else {
                const card = document.querySelector('.image-card');
                if (card) {
                    card.style.transition = 'transform 0.2s ease-out';
                    card.style.transform = 'translateX(0)';
                    setTimeout(() => {
                        card.style.transition = '';
                    }, 200);
                }
                // 恢复按钮状态
                updateButtonsOnSwipe(0);
            }
        }

        // 预加载下一张图片
        function preloadNextImages(currentIndex) {
            const preloadCount = 3;  // 预加载后面3张
            for (let i = 1; i <= preloadCount; i++) {
                const nextIndex = (currentIndex + i) % images.length;
                const nextImage = images[nextIndex];
                if (!preloadedImages.has(nextImage.url)) {
                    const img = new Image();
                    img.src = nextImage.url;
                    preloadedImages.set(nextImage.url, img);
                }
            }
        }

        // 添加退出按钮和统计功能
        function showExitStats() {
            const dialog = document.createElement('div');
            dialog.className = 'stats-dialog';
            // 添加遮罩层
            const overlay = document.createElement('div');
            overlay.className = 'dialog-overlay';
            document.body.appendChild(overlay);

            const title = document.createElement('h2');
            title.textContent = '御览统计';

            const content = document.createElement('p');
            const totalImages = images.length;
            const viewedImages = currentIndex + 1;
            const funnyRate = (funnyCount / viewedImages) * 100;
            content.innerHTML = `
                爱卿共览奏折 ${viewedImages} 篇<br>
                其中令朕龙颜大悦者 ${funnyCount} 篇<br>
                龙心悦指数：${Math.round(funnyRate)}%<br><br>
                <strong>${getEvaluationText(funnyRate)}</strong><br><br>
                <span style="font-size: 0.9em; opacity: 0.8;">小弟微信：hovgod</span>
            `;

            const confirmButton = document.createElement('button');
            confirmButton.textContent = '朕知道了';
            const closeDialog = () => {
                overlay.remove();
                dialog.remove();
            };

            // 点击遮罩层关闭
            overlay.addEventListener('click', closeDialog);
            // 点击按钮关闭
            confirmButton.addEventListener('click', closeDialog);

            dialog.appendChild(title);
            dialog.appendChild(content);
            dialog.appendChild(confirmButton);
            document.body.appendChild(dialog);

            // 修改样式
            const style = document.createElement('style');
            style.textContent = `
                .dialog-overlay {
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0, 0, 0, 0.5);
                    z-index: 1999;
                }

                .stats-dialog {
                    z-index: 2000;
                    background-color: var(--card-bg);
                    color: var(--text-color);
                    border: 1px solid var(--text-color);
                }

                .stats-dialog button {
                    background-color: var(--card-bg);
                    color: var(--text-color);
                    border: 1px solid var(--text-color);
                    padding: 12px 24px;
                    border-radius: 20px;
                    font-size: 16px;
                    cursor: pointer;
                    margin-top: 20px;
                    -webkit-tap-highlight-color: transparent;
                    transition: transform 0.1s ease;
                }

                .stats-dialog button:active {
                    transform: scale(0.98);
                }

                @media (max-width: 768px) {
                    .stats-dialog {
                        width: 80%;
                        max-width: 320px;
                        padding: 20px;
                    }

                    .stats-dialog button {
                        width: 100%;
                        padding: 15px;
                        margin-top: 15px;
                    }
                }
            `;
            document.head.appendChild(style);
        }

        window.addEventListener('DOMContentLoaded', async () => {
            await loadImages();  // 加载并显示图片

            // 主题设置初始化
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            document.body.setAttribute('data-theme', savedTheme);

            // 获取已经存在的主题切换按钮
            const themeToggle = document.querySelector('.theme-toggle');
            themeToggle.textContent = savedTheme === 'dark' ? '大佬请明目 🌙' : '大佬请护目 🌞';
            themeToggle.addEventListener('click', () => {
                const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
                document.documentElement.setAttribute('data-theme', isDark ? 'light' : 'dark');
                document.body.setAttribute('data-theme', isDark ? 'light' : 'dark');
                themeToggle.textContent = isDark ? '大佬请护目 🌞' : '大佬请明目 🌙';
                localStorage.setItem('theme', isDark ? 'light' : 'dark');
            });

            // 获取已经存在的退出按钮
            const exitButton = document.querySelector('.exit-button');
            exitButton.onclick = showExitStats;
        });

        // 防止滑动过程中触发其他事件
        imageContainer.addEventListener('click', (e) => {
            if (isMoving) {
                e.preventDefault();
                e.stopPropagation();
            }
        });

        // 防止图片拖拽
        imageContainer.addEventListener('dragstart', (e) => {
            e.preventDefault();
        });

        // 防止长图滑动时触发左右切换
        let isScrolling = false;
        let scrollTimeout;

        imageContainer.addEventListener('scroll', () => {
            isScrolling = true;
            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(() => {
                isScrolling = false;
            }, 100);
        }, true);

        // 清理过期的缓存图片
        function cleanupImageCache() {
            if (preloadedImages.size > MAX_CACHED_IMAGES * 1.5) {  // 允许更多缓存
                const currentUrl = images[currentIndex].url;
                const keysToDelete = Array.from(preloadedImages.keys())
                    .filter(key => key !== currentUrl)
                    .slice(0, preloadedImages.size - MAX_CACHED_IMAGES)
                    .filter(key => {
                        // 保留当前图片前后各 10 张的缓存
                        const index = images.findIndex(img => img.url === key);
                        return Math.abs(index - currentIndex) > 10;
                    });

                keysToDelete.forEach(key => {
                    preloadedImages.delete(key);
                });
            }
        }

        // 添加用户行为预测
        let swipeDirection = null;
        let swipeSpeed = 0;
        const swipeHistory = [];

        function predictNextAction() {
            if (swipeHistory.length < 3) return;

            // 分析最近的滑动行为
            const recentSwipes = swipeHistory.slice(-3);
            const avgSpeed = recentSwipes.reduce((sum, speed) => sum + speed, 0) / 3;
            const direction = recentSwipes[recentSwipes.length - 1] > 0 ? 1 : -1;

            // 预测下一个方向并预加载
            const predictedIndex = currentIndex + direction;
            if (predictedIndex >= 0 && predictedIndex < images.length) {
                const predictedImage = images[predictedIndex];
                if (!preloadedImages.has(predictedImage.url)) {
                    const img = new Image();
                    img.src = predictedImage.url;
                    preloadedImages.set(predictedImage.url, img);
                }
            }
        }

        // 添加移动端滑动提示
        function showSwipeHint() {
            const hint = document.createElement('div');
            hint.className = 'swipe-hint mobile-hint';
            hint.innerHTML = `
                <span class="left-button">👈 ${getRandomText(false)}</span>
                <span class="right-button">${getRandomText(true)} 👉</span>
            `;
            document.body.appendChild(hint);
        }

        // 修改移动端提示样式
        const style = document.createElement('style');
        style.textContent = `
            .swipe-hint {
                position: fixed !important;
                bottom: 20px !important;
                left: 0 !important;
                right: 0 !important;
                z-index: 1000;
                opacity: 1;
                display: flex;
                justify-content: center;
                gap: 20px;
                pointer-events: none;
                background: none !important;
                padding: 10px;
            }

            .swipe-hint span {
                min-width: 120px;
                background-color: rgba(255, 255, 255, 0.9);
                backdrop-filter: blur(5px);
                -webkit-backdrop-filter: blur(5px);
                padding: 10px 15px;
                font-size: 14px;
                border-radius: 20px;
                text-align: center;
                box-shadow: 0 2px 10px var(--shadow-color);
                pointer-events: auto;
                z-index: 1001;
                position: relative;
                white-space: nowrap;
                max-width: 45vw;
                overflow: hidden;
                text-overflow: ellipsis;
                cursor: pointer;
                user-select: none;
                -webkit-tap-highlight-color: transparent;
                transition: transform 0.1s ease;
            }

            .swipe-hint span:active {
                transform: scale(0.98);
            }

            [data-theme="dark"] .swipe-hint span:active {
                background-color: rgba(55, 55, 55, 0.9);
            }

            @media (max-width: 768px) {
                .swipe-hint {
                    bottom: 40px !important;
                    touch-action: manipulation;
                }

                .swipe-hint span {
                    touch-action: manipulation;
                    min-width: 100px;
                    padding: 12px 20px;
                }
            }

            /* 优化移动端触摸反馈 */
            @media (hover: hover) {
                .swipe-hint span:hover {
                    transform: scale(1.05);
                }
            }
        `;
        document.head.appendChild(style);

        // 修改更新滑动提示的函数
        function updateSwipeHint() {
            const oldHint = document.querySelector('.swipe-hint');
            if (oldHint) {
                oldHint.remove();
            }

            const hint = document.createElement('div');
            hint.className = 'swipe-hint';

            const leftSpan = document.createElement('span');
            leftSpan.className = 'left-button';
            const leftText = `👈 ${getRandomText(false)}`;
            leftSpan.innerHTML = leftText;
            leftSpan.setAttribute('data-text', leftText); // 保存初始文案

            const rightSpan = document.createElement('span');
            rightSpan.className = 'right-button';
            const rightText = `${getRandomText(true)} 👉`;
            rightSpan.innerHTML = rightText;
            rightSpan.setAttribute('data-text', rightText); // 保存初始文案

            // 修改点击事件处理
            leftSpan.addEventListener('click', () => {
                // 显示❎动画
                leftSpan.innerHTML = '❎';
                leftSpan.style.transform = 'translateX(-50%) scale(1.2)';
                rightSpan.style.opacity = '0.5';

                // 延迟执行切换图片
                setTimeout(() => {
                    currentIndex++;
                    showImage(currentIndex);
                    checkAndResetImages();

                    // 重新加载按钮文案
                    updateSwipeHint();
                }, 300);
            });

            rightSpan.addEventListener('click', () => {
                // 显示❤️动画
                rightSpan.innerHTML = '❤️';
                rightSpan.style.transform = 'translateX(50%) scale(1.2)';
                leftSpan.style.opacity = '0.5';

                // 延迟执行切换图片
                setTimeout(() => {
                    currentIndex++;
                    funnyCount++;
                    showImage(currentIndex);
                    checkAndResetImages();

                    // 重新加载按钮文案
                    updateSwipeHint();
                }, 300);
            });

            hint.appendChild(leftSpan);
            hint.appendChild(rightSpan);
            document.body.appendChild(hint);
        }

        // 修改 updateButtonsOnSwipe 函数，添加动画持续时间参数
        function updateButtonsOnSwipe(diff, duration = 200) {
            const leftButton = document.querySelector('.left-button');
            const rightButton = document.querySelector('.right-button');

            if (!leftButton || !rightButton) return;

            const threshold = window.innerWidth * 0.1;

            if (diff < -threshold) { // 左滑
                leftButton.innerHTML = '❎';
                leftButton.style.transform = 'scale(1.2)';
                rightButton.style.opacity = '0.5';

                // 添加过渡动画
                leftButton.style.transition = `all ${duration}ms ease`;
                rightButton.style.transition = `all ${duration}ms ease`;
            } else if (diff > threshold) { // 右滑
                rightButton.innerHTML = '❤️';
                rightButton.style.transform = 'scale(1.2)';
                leftButton.style.opacity = '0.5';

                // 添加过渡动画
                leftButton.style.transition = `all ${duration}ms ease`;
                rightButton.style.transition = `all ${duration}ms ease`;
            } else { // 恢复原状
                // 保持原有文案，只恢复样式
                leftButton.style.transform = '';
                rightButton.style.transform = '';
                leftButton.style.opacity = '';
                rightButton.style.opacity = '';

                // 如果当前是图标状态，则恢复为原始文案
                if (leftButton.innerHTML === '❎') {
                    leftButton.innerHTML = leftButton.getAttribute('data-text') || `👈 ${getRandomText(false)}`;
                }
                if (rightButton.innerHTML === '❤️') {
                    rightButton.innerHTML = rightButton.getAttribute('data-text') || `${getRandomText(true)} 👉`;
                }

                // 添加过渡动画
                leftButton.style.transition = `all ${duration}ms ease`;
                rightButton.style.transition = `all ${duration}ms ease`;
            }
        }

        // 修改评价文案函数
        function getEvaluationText(funnyRate) {
            const evaluations = [
                // 90-100%
                {
                    min: 90,
                    texts: [
                        "卧槽！这品味简直绝了！建议申请文化部常任理事！",
                        "我愿称您为新一代鉴赏大师，没有之一！",
                        "这眼光，莫非是上帝偷偷给开了天眼？",
                        "您这审美水平，已经可以出书收徒了！"
                    ]
                },
                // 80-89%
                {
                    min: 80,
                    texts: [
                        "这品味，怕是喝了十年茅台才练出来的吧？",
                        "您这审美，建议直接空降故宫当总策展！",
                        "不得了啊，看来是个资深老司机！",
                        "这鉴赏水平，建议申请非遗保护！"
                    ]
                },
                // 70-79%
                {
                    min: 70,
                    texts: [
                        "这品味，怕不是偷偷修炼了八十年？",
                        "您这眼光，简直就是一支会行走的显微镜！",
                        "啧啧，看来是个深藏不露的老手啊！",
                        "这水平，建议直接评为特级鉴赏师！"
                    ]
                },
                // 60-69%
                {
                    min: 60,
                    texts: [
                        "这品味，莫非是传说中的绝世高手？",
                        "您这审美，简直就是一台行走的艺术扫描仪！",
                        "哎呦，看来是个隐藏的资深玩家！",
                        "这水准，建议直接颁发终身成就奖！"
                    ]
                },
                // 50-59%
                {
                    min: 50,
                    texts: [
                        "这眼光，怕不是偷偷开了天眼？",
                        "您这品味，简直就是一个移动的艺术馆！",
                        "哦豁，看来是个深不可测的高手！",
                        "这水平，建议申请专业鉴赏证书！"
                    ]
                },
                // 40-49%
                {
                    min: 40,
                    texts: [
                        "这品味，莫非是传说中的艺术家转世？",
                        "您这眼光，简直就是一个行走的美学课堂！",
                        "嚯，看来是个低调的艺术家啊！",
                        "这水准，建议直接开设鉴赏课程！"
                    ]
                },
                // 30-39%
                {
                    min: 30,
                    texts: [
                        "这品味，怕不是偷偷修炼了几十年？",
                        "您这审美，简直就是一个行走的艺术品！",
                        "哟，看来是个深藏不露的艺术家！",
                        "这水平，建议申请艺术顾问职位！"
                    ]
                },
                // 20-29%
                {
                    min: 20,
                    texts: [
                        "这眼光，莫非是传说中的艺术特工？",
                        "您这品味，简直就是一个移动的美术馆！",
                        "嘿，看来是个隐藏的艺术达人！",
                        "这水准，建议直接开个艺术工作室！"
                    ]
                },
                // 10-19%
                {
                    min: 10,
                    texts: [
                        "这品味，怕不是偷偷研究了好几年？",
                        "您这审美，简直就是一个行走的画廊！",
                        "哇，看来是个低调的艺术爱好者！",
                        "这水平，建议考虑当个艺术评论家！"
                    ]
                },
                // 0-9%
                {
                    min: 0,
                    texts: [
                        "这眼光，莫非是来自平行宇宙的艺术家？",
                        "您这品味，简直就是一个另类的艺术流派！",
                        "嘛，看来是个特立独行的艺术家！",
                        "这水准，建议创立新的艺术流派！"
                    ]
                }
            ];

            // 找到对应区间的评价
            const evaluation = evaluations.find(e => funnyRate >= e.min);
            // 从对应区间随机选择一条评价
            return evaluation.texts[Math.floor(Math.random() * evaluation.texts.length)];
        }

        // 修改滚动处理函数
        let startY = 0;
        let isAtEdge = true;

        function handleScrollStart(e) {
            startY = e.touches[0].clientY;
            const card = e.currentTarget;
            isAtEdge = (card.scrollTop <= 0 || card.scrollTop >= card.scrollHeight - card.clientHeight - 10);
        }

        function handleScrollMove(e) {
            const card = e.currentTarget;
            const currentY = e.touches[0].clientY;
            const deltaY = currentY - startY;

            // 检查是否在滚动边界
            const isAtTop = card.scrollTop <= 0;
            const isAtBottom = card.scrollTop >= card.scrollHeight - card.clientHeight - 10;

            // 如果在顶部下拉或在底部上拉，允许左右滑动
            if ((isAtTop && deltaY > 0) || (isAtBottom && deltaY < 0)) {
                return;
            }

            // 否则阻止默认行为和事件冒泡，专注于滚动
            e.preventDefault();
            e.stopPropagation();
        }

        // 修改滚动提示函数
        function showScrollHint() {
            const existingHint = document.querySelector('.scroll-hint');
            if (existingHint) return;

            const hint = document.createElement('div');
            hint.className = 'scroll-hint';
            hint.innerHTML = '↕️';
            document.body.appendChild(hint);

            // 添加滚动进度指示器
            const progress = document.createElement('div');
            progress.className = 'scroll-progress';
            const progressBar = document.createElement('div');
            progressBar.className = 'scroll-progress-bar';
            progress.appendChild(progressBar);
            document.body.appendChild(progress);

            // 监听滚动更新进度条
            const card = document.querySelector('.image-card');
            const updateProgress = () => {
                const scrollPercent = (card.scrollTop / (card.scrollHeight - card.clientHeight)) * 100;
                progressBar.style.height = `${scrollPercent}%`;
            };

            // 添加滚动事件监听
            card.addEventListener('scroll', () => {
                updateProgress();
                progress.style.opacity = '1';
                clearTimeout(progress.fadeTimeout);
                progress.fadeTimeout = setTimeout(() => {
                    progress.style.opacity = '0';
                }, 1000);
            });

            // 3秒后淡出提示
            setTimeout(() => {
                hint.style.opacity = '0';
                setTimeout(() => hint.remove(), 500);
            }, 3000);
        }

        // 添加键盘事件处理
        document.addEventListener('keydown', (e) => {
            const card = document.querySelector('.image-card');
            if (!card || !card.classList.contains('scrollable')) return;

            const scrollAmount = 100; // 每次滚动的像素量

            switch (e.key) {
                case 'ArrowUp':
                    e.preventDefault();
                    card.scrollBy({
                        top: -scrollAmount,
                        behavior: 'smooth'
                    });
                    break;
                case 'ArrowDown':
                    e.preventDefault();
                    card.scrollBy({
                        top: scrollAmount,
                        behavior: 'smooth'
                    });
                    break;
            }
        });

        // 获取pic2文件夹中的图片列表
        async function fetchImageList() {
            try {
                const response = await fetch('pic2/image_list.json');
                if (!response.ok) throw new Error('无法获取图片列表');
                return await response.json();
            } catch (error) {
                console.error('加载图片列表失败:', error);
                return [];
            }
        }

        // 随机选择并显示图片
        async function showRandomImage() {
            const images = await fetchImageList();
            if (images.length === 0) {
                console.error('没有可用的图片');
                return;
            }

            const randomImage = images[Math.floor(Math.random() * images.length)];
            const imageContainer = document.getElementById('image-container');
            imageContainer.innerHTML = `<img src="pic2/${randomImage}" alt="Random Image" style="max-width: 100%; height: auto;">`;
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', showRandomImage);
    </script>
</body>

</html>